---
external help file: Azure_antimalware.xml
online version: http://go.microsoft.com/fwlink/?LinkID=402844
schema: 2.0.0
---

# Set-AzureVMMicrosoftAntimalwareExtension
## SYNOPSIS
Configures the Microsoft Antimalware extension for a virtual machine.

## SYNTAX

### UNNAMED_PARAMETER_SET_1
```
Set-AzureVMMicrosoftAntimalwareExtension [-AntimalwareConfigFile] <String> [[-Version] <String>] [-Monitoring]
 [[-StorageContext] <AzureStorageContext>] -VM <IPersistentVM>
```

### UNNAMED_PARAMETER_SET_2
```
Set-AzureVMMicrosoftAntimalwareExtension [-AntimalwareConfiguration] <String> [[-Version] <String>]
 [-Monitoring] [[-StorageContext] <AzureStorageContext>] -VM <IPersistentVM>
```

### UNNAMED_PARAMETER_SET_3
```
Set-AzureVMMicrosoftAntimalwareExtension [[-Version] <String>] [-Disable] -VM <IPersistentVM>
```

### UNNAMED_PARAMETER_SET_4
```
Set-AzureVMMicrosoftAntimalwareExtension [-NoConfig]
```

### UNNAMED_PARAMETER_SET_5
```
Set-AzureVMMicrosoftAntimalwareExtension [-Uninstall] -VM <IPersistentVM>
```

## DESCRIPTION
The Set-AzureVMMicrosoftAntimalwareExtension cmdlet configures the Microsoft Antimalware extension for a virtual machine.
You can enable, disable, or uninstall the extension.

## EXAMPLES

### Example 1: Enable the extension by using a configuration file
```
PS C:\>Get-AzureVM -ServiceName "ContosoService03" -Name "ContosoVM22" | Set-AzureVMMicrosoftAntimalwareExtension -AntimalwareConfigFile 'C:\configuration\contosoVM.json' | Update-AzureVM
```

This command enables the Microsoft Antimalware extension by using a configuration file.
The command uses the Get-AzureVM cmdlet to get the specified virtual machine object, and then passes the object to the current cmdlet by using the pipeline operator.

The AntimalwareConfigFile parameter specifies a configuration file for the Microsoft Antimalware extension.
Set-AzureVMMicrosoftAntimalwareExtension applies the configuration that the file specifies to the virtual machine, and then passes the result to the Update-AzureVM cmdlet to update the virtual machine.

### Example 2: Enable the extension and enable monitoring
```
PS C:\>$StorageContext = New-AzureStorageContext -StorageAccountName "contosostoragemain" -StorageAccountKey (Get-AzureStorageKey -StorageAccountName "Contosostoragemain").Primary
PS C:\> Get-AzureVM -ServiceName "ContosoService03" -Name"ContosoVM22" | Set-AzureVMMicrosoftAntimalwareExtension -AntimalwareConfigFile 'C:\configuration\contosoVM.xml" -Monitoring ON -StorageContext $StorageContext | Update-AzureVM
```

The first command creates an AzureStorageContext object by using the New-AzureStorageContext cmdlet, and then stores it in the $StorageContext variable.

The second command enables the Microsoft Antimalware extension, and enables monitoring.
The command uses Get-AzureVM to get the specified virtual machine object, and then passes the object to the current cmdlet.

The command specifies a value of ON for the Monitoring parameter and specifies the Azure storage context stored in $StorageContext, and then passes the result to the Update-AzureVM cmdlet.

### Example 3: Enable the extension by specifying a configuration object
```
PS C:\>$config_string = '{"AntimalwareEnabled" : true}'
PS C:\> Get-AzureVM -ServiceName "ContosoService03" -Name "ContosoVM22" | Set-AzureVMMicrosoftAntimalwareExtension -AntimalwareConfiguration $config_string | Update-AzureVM
```

The first command creates a string object by reading a JSON configuration for the Microsoft Antimalware extension, and then storing it in the $config_string variable.

The second command uses Get-AzureVM to get the specified virtual machine object, and then passes the object to Set-AzureVMMicrosoftAntimalwareExtension to apply that configuration to the virtual machine.
The AntimalwareConfiguration parameter specifies the configuration information stored in $config_string.
The result is passed to the Update-AzureVM cmdlet.

### Example 4: Disable the extension
```
PS C:\>Get-AzureVM -ServiceName "ContosoService03" -Name "ContosoVM22" | Set-AzureVMMicrosoftAntimalwareExtension -Disable | Update-AzureVM
```

This command disables the extension without removing it.
The command uses Get-AzureVM to get the specified virtual machine object, and then passes the object to the current cmdlet.

Set-AzureVMMicrosoftAntimalwareExtension disables the Microsoft Antimalware extension for the virtual machine, and then passes the result to Update-AzureVM.

To enable the extension on the same virtual machine again, run Set-AzureVMMicrosoftAntimalwareExtension cmdlet without specifying the Disable parameter.

### Example 5: Remove the extension
```
PS C:\>Get-AzureVM -ServiceName "ContosoService03" -Name"ContosoVM22" | Set-AzureVMMicrosoftAntimalwareExtension -Uninstall | Update-AzureVM
```

This command removes the Microsoft Antimalware extension from the virtual machine.
The command uses Get-AzureVM to get the specified virtual machine object, and then passes the object to the current cmdlet.

Set-AzureVMMicrosoftAntimalwareExtension removes the extension.
If monitoring was turned on, the cmdlet also removes the collection of Microsoft Antimalware events.
The command passes the result to Update-AzureVM.

## PARAMETERS

### -AntimalwareConfigFile
Specifies the absolute path to the Microsoft Antimalware configuration file.
Donâ€™t specify this parameter if you specify the AntimalwareConfiguration parameter.
The configuration file must include, at a minimum, the following content to enable the Microsoft Antimalware extension: 

{ "AntimalwareEnabled": true }

You can configure the following settings in this configuration file: 

Setting: AntimalwareEnabled
Values: true (case sensitive) 
A value of true enables the Microsoft Antimalware extension.
The value false is not supported.
This setting is required. 
Default: None

Setting: RealtimeProtectionEnabled
Values: true or false (case sensitive) 
A value of true enables Real-time protection.
A value of false disables Real-time protection. 
Default: true when AntimalwareEnabled has a value of true. 

Setting: ScheduledScanSettings isEnabled property
Values: true or false (case sensitive) 
Enables or disables a periodic scan for active malware. 
Default: false

Setting: ScheduledScanSettings day property
Values: 0 through 8

 -- 0: Scan daily
-- 1: Scan Sunday
-- 2: Scan Monday
-- 3: Scan Tuesday
-- 4: Scan Wednesday
-- 5: Scan Thursday
-- 6: Scan Friday
-- 7: Scan Saturday
-- 8: Disabled

Default: 7 if you specify a value of true for the isEnabled property of ScheduledScanSettings

Setting: ScheduledScanSettings time property 
Values: 0 through 1440
Specify the hour at which to begin the scan in increments of 60 minutes after midnight.
Specify a value of 60 for 1:00 A.M. 
Default: 120 if you specify a value of true for the isEnabled property of ScheduledScanSettings 

Setting: ScheduledScanSettings scanType property
Values: Quick or Full
Default: Quick if you specify a value of true for the isEnabled property of ScheduledScanSettings 

Setting: Exclusions for file name extensions
Values: File name extensions
List the file name extensions to exclude from scanning.
To specify multiple file types to exclude, separate each entry with a semicolon.
To exclude files that have the file name extensions .gif, .log, or .txt, specify the following text: 

gif; log; txt

For JavaScript Object Notation (JSON) configuration, separate multiple file name extensions by using the semicolon.
We do not recommend that you use wildcard characters. 
Default: None

Setting: Exclusions for paths
Values: File and folder paths
List the paths of files or folders to exclude from scanning.
To specify multiple paths to exclude, separate each entry with a semicolon.
To exclude the file worker.dll in the e:\approot folder and anything under the folder e:\approot\temp, specify the following paths: 

e:\\\\approot\\\\worker.dll; e:\\\\approot\\\\temp

For JSON configuration for virtual machines, use a second slash as an escape character for the slash, as in e:\\\\approot\\\\worker.dll. 
Add all excluded paths as a semicolon separated list in JSON configuration.
We do not recommend that you use wildcard characters. 
Default: None

Setting: Exclusions for processes
Values: Process names
List the process exclusions.
The Microsoft Antimalware extension does not scan any file that an excluded process opens.
The Microsoft Antimalware extension scans the process itself.
To exclude the process itself, use the Paths property.
To specify multiple processes to exclude, separate each entry with a semicolon.
The Microsoft Antimalware extension excludes from scanning any file opened by the MyApp.exe based on this example: 

C:\\\\Program Files\\\\MyApp.exe

This example uses a second slash as an escape character.
Add all excluded processes as a semicolon separated list in JSON configuration. 
Default: None

The following is an example of a configuration file containing additional settings.
Note that slash characters in exclusion paths must be properly escaped, by specifying two slashes.
Using wildcard characters in the exclusion set is not recommended.

{
  "AntimalwareEnabled": true, 
    "RealtimeProtectionEnabled": true, 
       "ScheduledScanSettings": {
        "isEnabled": true, 
        "day": 1, 
        "time": 120, 
        "scanType": "Full"
  },
  "Exclusions": {
    "Extensions": ".ext1;.ext2",
    "Paths": "c:\\\\excluded-path-1;c:\\\\excluded-path-2",
    "Processes": "excludedproc1.exe;excludedproc2.exe"
  }
}

```yaml
Type: String
Parameter Sets: UNNAMED_PARAMETER_SET_1
Aliases: 

Required: True
Position: 2
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -AntimalwareConfiguration
Specifies a string object that contains the Microsoft Antimalware configuration.
This object must not be $Null or empty.
Donâ€™t specify this parameter if you specify the AntimalwareConfigFile parameter.
The configuration object must include, at a minimum, the following content to enable the Microsoft Antimalware extension: 

{ "AntimalwareEnabled": true }

```yaml
Type: String
Parameter Sets: UNNAMED_PARAMETER_SET_2
Aliases: 

Required: True
Position: 2
Default value: None
Accept pipeline input: True(ByPropertyName)
Accept wildcard characters: False
```

### -Disable
Indicates that the cmdlet disables the Microsoft Antimalware extension.
To re-enable the extension on the same virtual machine, run Set-AzureVMMicrosoftAntimalwareExtension without the Disable parameter.

```yaml
Type: SwitchParameter
Parameter Sets: UNNAMED_PARAMETER_SET_3
Aliases: 

Required: False
Position: 3
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -Monitoring
Specifies whether to collect Microsoft Antimalware events.
Valid values are: 

-- ON.
Collect Microsoft Antimalware events to the specified storage context.
-- OFF.
Do not collect Microsoft Antimalware events.

```yaml
Type: SwitchParameter
Parameter Sets: UNNAMED_PARAMETER_SET_1, UNNAMED_PARAMETER_SET_2
Aliases: 
Accepted values: ON, OFF

Required: False
Position: 4
Default value: None
Accept pipeline input: True(ByPropertyName)
Accept wildcard characters: False
```

### -NoConfig
You can configure the following settings in this configuration file: 

Setting: AntimalwareEnabled
Values: true (case sensitive) 
A value of true enables the Microsoft Antimalware extension.
The value false is not supported.
This setting is required. 
Default: None

Setting: RealtimeProtectionEnabled
Values: true or false (case sensitive) 
A value of true enables Real-time protection.
A value of false disables Real-time protection. 
Default: true when AntimalwareEnabled has a value of true. 

Setting: ScheduledScanSettings isEnabled property
Values: true or false (case sensitive) 
Enables or disables a periodic scan for active malware. 
Default: false

Setting: ScheduledScanSettings day property
Values: 0 through 8

 -- 0: Scan daily
-- 1: Scan Sunday
-- 2: Scan Monday
-- 3: Scan Tuesday
-- 4: Scan Wednesday
-- 5: Scan Thursday
-- 6: Scan Friday
-- 7: Scan Saturday
-- 8: Disabled

Default: 7 if you specify a value of true for the isEnabled property of ScheduledScanSettings

Setting: ScheduledScanSettings time property 
Values: 0 through 1440
Specify the hour at which to begin the scan in increments of 60 minutes after midnight.
Specify a value of 60 for 1:00 A.M. 
Default: 120 if you specify a value of true for the isEnabled property of ScheduledScanSettings 

Setting: ScheduledScanSettings scanType property
Values: Quick or Full
Default: Quick if you specify a value of true for the isEnabled property of ScheduledScanSettings 

Setting: Exclusions for file name extensions
Values: File name extensions
List the file name extensions to exclude from scanning.
To specify multiple file types to exclude, separate each entry with a semicolon.
To exclude files that have the file name extensions .gif, .log, or .txt, specify the following text: 

gif; log; txt

For JavaScript Object Notation (JSON) configuration, separate multiple file name extensions by using the semicolon.
We do not recommend that you use wildcard characters. 
Default: None

Setting: Exclusions for paths
Values: File and folder paths
List the paths of files or folders to exclude from scanning.
To specify multiple paths to exclude, separate each entry with a semicolon.
To exclude the file worker.dll in the e:\approot folder and anything under the folder e:\approot\temp, specify the following paths: 

e:\\\\approot\\\\worker.dll; e:\\\\approot\\\\temp

For JSON configuration for virtual machines, use a second slash as an escape character for the slash, as in e:\\\\approot\\\\worker.dll. 
Add all excluded paths as a semicolon separated list in JSON configuration.
We do not recommend that you use wildcard characters. 
Default: None

Setting: Exclusions for processes
Values: Process names
List the process exclusions.
The Microsoft Antimalware extension does not scan any file that an excluded process opens.
The Microsoft Antimalware extension scans the process itself.
To exclude the process itself, use the Paths property.
To specify multiple processes to exclude, separate each entry with a semicolon.
The Microsoft Antimalware extension excludes from scanning any file opened by the MyApp.exe based on this example: 

C:\\\\Program Files\\\\MyApp.exe

This example uses a second slash as an escape character.
Add all excluded processes as a semicolon separated list in JSON configuration. 
Default: None

The following is an example of a configuration file containing additional settings.
Note that slash characters in exclusion paths must be properly escaped, by specifying two slashes.
Using wildcard characters in the exclusion set is not recommended.

{
  "AntimalwareEnabled": true, 
    "RealtimeProtectionEnabled": true, 
       "ScheduledScanSettings": {
        "isEnabled": true, 
        "day": 1, 
        "time": 120, 
        "scanType": "Full"
  },
  "Exclusions": {
    "Extensions": ".ext1;.ext2",
    "Paths": "c:\\\\excluded-path-1;c:\\\\excluded-path-2",
    "Processes": "excludedproc1.exe;excludedproc2.exe"
  }
}

```yaml
Type: SwitchParameter
Parameter Sets: UNNAMED_PARAMETER_SET_4
Aliases: 

Required: True
Position: 4
Default value: None
Accept pipeline input: True(ByPropertyName)
Accept wildcard characters: False
```

### -StorageContext
Specifies an Azure storage context for Microsoft Antimalware monitoring.
You must specify a valid storage context when monitoring is set to ON.

```yaml
Type: AzureStorageContext
Parameter Sets: UNNAMED_PARAMETER_SET_1, UNNAMED_PARAMETER_SET_2
Aliases: 

Required: False
Position: 5
Default value: None
Accept pipeline input: True(ByPropertyName)
Accept wildcard characters: False
```

### -Uninstall
Indicates that this cmdlet uninstalls the Microsoft Antimalware extension from the virtual machine.
If monitoring was turned on, the cmdlet also removes the collection of Microsoft Antimalware events.

```yaml
Type: SwitchParameter
Parameter Sets: UNNAMED_PARAMETER_SET_5
Aliases: 

Required: True
Position: 2
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -Version
Specifies the extension version as a string.

```yaml
Type: String
Parameter Sets: UNNAMED_PARAMETER_SET_1, UNNAMED_PARAMETER_SET_2
Aliases: 

Required: False
Position: 3
Default value: None
Accept pipeline input: True(ByPropertyName)
Accept wildcard characters: False
```

```yaml
Type: String
Parameter Sets: UNNAMED_PARAMETER_SET_3
Aliases: 

Required: False
Position: 3
Default value: None
Accept pipeline input: True(ByPropertyName)
Accept wildcard characters: False
```

### -VM
Specifies the virtual machine as an IPersistentVM object.

```yaml
Type: IPersistentVM
Parameter Sets: UNNAMED_PARAMETER_SET_1, UNNAMED_PARAMETER_SET_3, UNNAMED_PARAMETER_SET_5
Aliases: InputObject

Required: True
Position: Named
Default value: None
Accept pipeline input: True (ByValue, ByPropertyName)
Accept wildcard characters: False
```

```yaml
Type: IPersistentVM
Parameter Sets: UNNAMED_PARAMETER_SET_2
Aliases: InputObject

Required: True
Position: Named
Default value: None
Accept pipeline input: True (ByValue, ByPropertyName)
Accept wildcard characters: False
```

## INPUTS

## OUTPUTS

## NOTES

## RELATED LINKS

[Get-AzureVM](http://msdn.microsoft.com/en-us/library/dn495236.aspx)

[Update-AzureVM](http://msdn.microsoft.com/en-us/library/dn495230.aspx)

[Get-AzureVMMicrosoftAntimalwareExtension](c8fce2de-0342-4690-b43b-3565a0ff0fdb)

[Remove-AzureVMMicrosoftAntimalwareExtension](d0063033-35f1-4467-bbdd-f4c569a98810)

